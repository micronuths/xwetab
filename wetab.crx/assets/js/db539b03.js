"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[3668],{43670:(s,e,o)=>{o.d(e,{B:()=>i});var r=o(74003),a=o(97432);const i=new class{hasPermission=async()=>new Promise((s=>{if(!r.Pl)return chrome.permissions.contains({permissions:["system.cpu","system.memory"]},(e=>{s(e)}));s(!1)}));reqPermission=async()=>new Promise((s=>{r.Pl?s(!1):chrome.permissions.request({permissions:["system.cpu","system.memory"]},(e=>{chrome.runtime.lastError?s(!1):s(e)}))}));hasBookmarksPermission=async()=>new Promise((s=>{if(!r.Pl)return chrome.permissions.contains({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?chrome.permissions.contains({permissions:["bookmarks"]},(e=>{s(e)})):s(e)}));s(!1)}));reqBookmarksPermission=async()=>new Promise((s=>{r.Pl?s(!1):chrome.permissions.request({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?"'favicon' is not a recognized permission."==chrome.runtime.lastError.message?((0,a.useBookmarksStore)().setFavicon(!0),chrome.permissions.request({permissions:["bookmarks"]},(e=>{s(e)}))):s(!1):s(e)}))}));getCpuInfo=()=>chrome.system.cpu.getInfo();getStorageInfo=()=>chrome.system.storage.getInfo();getMemoryInfo=()=>chrome.system.memory.getInfo()}},97432:(s,e,o)=>{o.r(e),o.d(e,{useBookmarksStore:()=>h});var r=o(43670),a=o(84522),i=o(10435),t=o(17319),n=o(87322);const m=async(s,e)=>{try{await chrome.bookmarks.move(s,e)}catch(s){s&&t.R.fail({message:"操作失败！",duration:1500})}},c=async s=>{await(0,n.stopBrowserListening)(),await Promise.all(s.map((async s=>{await(async s=>{try{await chrome.bookmarks.remove(s)}catch(s){s&&t.R.fail({message:"操作失败！",duration:1500})}})(s)}))),await(0,n.startBrowserListening)()};var k=o(81220);const h=(0,i.Q_)(a.BU.bookmarks,{syncStorage:{watch:["isFirst","bookmarks","flattenBookmarks","folderList","needInfinityFavicon"]},state:()=>({isFullScreen:!1,isFirst:!0,modalShow:!1,hasPermission:!1,bookmarks:[],flattenBookmarks:[],folderList:[],needInfinityFavicon:!1}),actions:{setModal(s){this.modalShow=s},setBookmarks(s){this.bookmarks=s},setIsFirst(s){this.isFirst=s},setIsFullScreen(s){this.isFullScreen=s},async getAllData(){if(this.hasPermission=await r.B.hasBookmarksPermission(),!this.hasPermission)return;const[s,e,o]=await(0,k.jl)();this.bookmarks=s,this.flattenBookmarks=e,this.folderList=o},setFaviconById(s,e){this.bookmarks=[...(0,k.Ob)(this.bookmarks,e,{favicon:s})],this.flattenBookmarks=(0,k.Qj)(this.bookmarks),this.folderList=(0,k.Ln)(this.flattenBookmarks)},async reqPermission(){return this.hasPermission=await r.B.reqBookmarksPermission(),this.hasPermission},async batchMoveBookmark(s,e){await(async(s,e)=>{await(0,n.stopBrowserListening)(),await Promise.all(s.map((async s=>{await m(s,e)}))),await(0,n.startBrowserListening)()})(s,e),this.getAllData()},async batchRemoveBookmark(s){await c(s),this.getAllData()},async updateBookmark(s,e){await(async(s,e)=>{try{await(0,n.stopBrowserListening)(),await chrome.bookmarks.update(s,e),await(0,n.startBrowserListening)()}catch(s){s&&t.R.fail({message:"操作失败！",duration:1500})}})(s,{title:e.title,url:e.url}),e.parentId&&await m(s,{parentId:e.parentId}),this.getAllData()},setFavicon(s){this.needInfinityFavicon=s}}})},87322:(s,e,o)=>{o.r(e),o.d(e,{startBrowserListening:()=>c,stopBrowserListening:()=>k});var r=o(43670),a=o(97432);const i=(s,e)=>{(0,a.useBookmarksStore)().getAllData()},t=(s,e)=>{(0,a.useBookmarksStore)().getAllData()},n=(s,e)=>{(0,a.useBookmarksStore)().getAllData()},m=(s,e)=>{(0,a.useBookmarksStore)().getAllData()},c=async()=>{await r.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.addListener(i),chrome.bookmarks.onChanged.addListener(t),chrome.bookmarks.onRemoved.addListener(n),chrome.bookmarks.onMoved.addListener(m))},k=async()=>{await r.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.removeListener(i),chrome.bookmarks.onChanged.removeListener(t),chrome.bookmarks.onRemoved.removeListener(n))}},81220:(s,e,o)=>{o.d(e,{GR:()=>c,Ln:()=>t,OK:()=>n,Ob:()=>m,Qj:()=>i,jl:()=>a});var r=o(45844);const a=async()=>{const s=await chrome.bookmarks.getTree(),e=k(s);return[s,e,t(e)]},i=s=>k(s),t=s=>s.filter((s=>{var e;return"0"!=s.id&&s.children&&(null===(e=c(s))||void 0===e?void 0:e.length)>0})),n=s=>s.filter((s=>"0"!=s.id&&s.children)),m=(s,e,o)=>{const a=(0,r.Z)(s);return a.forEach(((s,e)=>o=>{const r=o=>{o.id===s?Object.assign(o,e):o.children&&o.children.forEach(r)};return r(o)})(e,o)),a},c=s=>{var e;return s?null===(e=s.children)||void 0===e?void 0:e.filter((s=>s.url)):[]};function k(s,e){return s.reduce(((s,o)=>(s.push({id:o.id,parentId:(null==e?void 0:e.id)||"",title:o.title,url:o.url,children:o.children,index:o.index}),o.children&&s.push(...k(o.children,o)),s)),[])}}}]);